# AI Automation Framework - Cursor Rules

This repository contains shared AI automation rules, skills, and workflows for OutSystems teams.

## Framework Structure

- **`.cursor/shared/skills/`** - Reusable task rules (PR creation, Jira updates, branch naming, design verification) - **Shared across all repos**
- **`.cursor/agents/`** - Orchestrator agents (automation repo only)
- **`.cursor/skills/`** - Agent-specific skills (automation repo only), e.g. prepare XIF from local
- **`.cursor/teams/`** - Team-specific overrides (automation repo only)
- **`infrastructure/`** - MCP server configurations (automation repo only)
- **`projects/`** - Project-specific configurations (automation repo only)

## Using Skills and Agents

When the user requests automation tasks, use natural language and automatically identify which skills/agents to use from this framework.

**Natural Language Examples:**
- "Create a PR" → Use `.cursor/shared/skills/pr-creation/SKILL.md` rules
- "Update the Jira story" → Use `.cursor/shared/skills/jira-updates/SKILL.md` rules
- "Create a branch" → Use `.cursor/shared/skills/branch-naming/SKILL.md` rules
- "Check if this matches Figma" → Use `.cursor/shared/skills/design-verification/SKILL.md` rules
- "Test in ODC" or "Create test app" → Use `.cursor/shared/skills/odc-testing/SKILL.md` rules
- "Prepare XIF from local", "XIF prepare", "prepare xif", or "Bundle and prepare XIF" → Use `.cursor/skills/mobile-ui-prepare-xif-from-local/SKILL.md` (then delegate to repo agents)
- "Complete this story" or "End-to-end Mobile UI change" or "Publish XIF" → Use `.cursor/agents/mobile-ui.md` workflow

**Prefixes are optional** - The user may use `skill:` or `agent:` prefixes, but natural language is preferred and works just as well. The AI should infer which skill/agent to use from the request context.

## Configuration Hierarchy

When resolving which rules to use, follow this priority order:

1. `.cursor/` (in user's repo) - Repo-specific agents, skills, and overrides (highest priority)
2. `.cursor/teams/{team}/` (in automation repo) - Team-specific overrides
3. `.cursor/shared/skills/` (in automation repo) - Shared skills (lowest priority)

**Orchestrator Agents**: Located in automation repo `.cursor/agents/` (e.g., `mobile-ui.md`)
**Agent-Specific Skills**: Located in automation repo `.cursor/skills/` (e.g., `mobile-ui-prepare-xif-from-local/SKILL.md`)
**Repository-Specific Agents/Skills**: Located in their respective repos (e.g., `runtime-mobile-widgets-js/.cursor/agents/`, `OutSystems.WidgetLibrary/.cursor/skills/`)

## Key Rules

### PR Creation
- **Always** use `skill:pr-creation` when creating pull requests
- **Must** follow format: `<jira-issue>: <subject>` (with colon)
- **Must** set at least one label
- **Must** fill Context and Impacts sections

### Jira Updates
- **Always** use `skill:jira-updates` when updating Jira stories
- **Must** update "What I Did" section with implementation details
- **Must** include verification steps

### Branch Naming
- **Always** use `skill:branch-naming` when creating branches
- **Must** follow format: `ROU-XXXX` (just the Jira issue ID)
- **Must** branch from `main` (for widgets-js) or `dev` (for WidgetLibrary)

### Design Verification
- **Always** use `skill:design-verification` when verifying designs against Figma
- **Must** compare Figma values with codebase tokens
- **Must** flag any discrepancies

### XIF Prepare (from local)
- **Always** use `skill:mobile-ui-prepare-xif-from-local` when preparing XIF from local (xif prepare, bundle and prepare XIF)
- **Must** delegate to agent:widgets-js (build) then agent:widget-library (update from local + prepare XIF); do not run npm commands directly

## Workflow Agents

### Mobile UI (Orchestrator)
- Use `agent:mobile-ui` for complete Mobile UI story workflows
- Orchestrates: delegates to `agent:widgets-js` → `agent:widget-library` → ODC testing → PR creation
- Handles cross-repo coordination and ODC testing
- Most comprehensive agent for Mobile UI work

### Repository-Specific Agents
- **`agent:widgets-js`** - Located in `runtime-mobile-widgets-js/.cursor/agents/`
  - Handles implementation workflow for widgets-js repository
  - Can be used standalone or as part of orchestrator workflow

- **`agent:widget-library`** - Located in `OutSystems.WidgetLibrary/.cursor/agents/`
  - Handles WidgetLibrary consumption and XIF preparation
  - Can be used standalone or as part of orchestrator workflow

**Note**: `design-verification` and `pr-creation` are skills only, not agents. Agents orchestrate workflows, skills are single tasks.

## MCP Servers

This framework uses the following MCP servers (configured in `~/.cursor/mcp.json`):
- **Jira** (Atlassian MCP) - For issue management
- **Figma** (Framelink MCP) - For design verification
- **GitHub** (via CLI) - For PR management
- **Browser** - For visual verification (can be flaky)

## Important Notes

- **Never commit credentials** - All credentials are in `.env` files (gitignored)
- **Always validate** - Check that PR titles, branch names, etc. follow conventions
- **Use natural language** - Infer which skill/agent to use from the user's request (no need for explicit prefixes)
- **Read skill/agent files** - When a task matches a skill or agent, read the corresponding file from `.cursor/shared/skills/` (shared skills), `.cursor/skills/` (agent-specific skills, automation repo), `.cursor/agents/` (orchestrator agents), or repo-specific `.cursor/agents/` or `.cursor/skills/` (repo agents/skills) and follow its rules
- **Use project configs** - Check `projects/{project}/config.json` in the automation repo for project-specific settings (Figma file keys, Jira projects, etc.)

## Examples

**User**: "Create a PR for my changes"
**AI**: Read `.cursor/shared/skills/pr-creation/SKILL.md` and follow those rules to create PR with proper title format, labels, and template sections.

**User**: "Update the Jira story with what I did"
**AI**: Read `.cursor/shared/skills/jira-updates/SKILL.md` and follow those rules to update the "What I Did" section with implementation details and verification steps.

**User**: "Complete story ROU-12345" or "End-to-end Mobile UI change"
**AI**: Read `.cursor/agents/mobile-ui.md` (orchestrator) which delegates to:
  - `runtime-mobile-widgets-js/.cursor/agents/widgets-js.md` (Phase 1)
  - `OutSystems.WidgetLibrary/.cursor/agents/widget-library.md` (Phase 2 & 3)
  - Then handles ODC testing, Jira updates, and PR creation

**User**: "Check if my component matches Figma"
**AI**: Read `.cursor/shared/skills/design-verification/SKILL.md` and follow those rules to fetch Figma specs, compare with codebase tokens, and flag any discrepancies.

**Note**: The AI should automatically identify which skill/agent to use from natural language. No need for explicit prefixes unless the user uses them.
